<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Presupuesto Personal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Meta tag para adaptar a dispositivos mÃ³viles -->
<!-- Agregar Font Awesome para iconos -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f6f8;
        padding: 20px;
    }
    h1 {
        color: #2c3e50;
        text-align: center;
        font-size: 2rem;
    }
    .card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        max-width: 600px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        margin: 0 auto;
    }
    input, select, button {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        box-sizing: border-box; /* Asegura que los elementos se ajusten bien */
    }
    button {
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .btn-add { background: #2ecc71; color: white; }
    .btn-add:hover { background-color: #27ae60; }
    .btn-del { background: #e74c3c; color: white; }
    .btn-del:hover { background-color: #c0392b; }
    .btn-exp { background: #3498db; color: white; }
    .btn-exp:hover { background-color: #2980b9; }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 0.9rem;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 12px;
        text-align: center;
    }
    th {
        background-color: #f2f2f2;
    }
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    .resumen {
        font-weight: bold;
        margin-top: 10px;
        font-size: 1.1rem;
    }
    .negativo { color: red; }
    .positivo { color: green; }
    
    .icon {
        font-size: 1.5rem;
        color: #16a085;
    }

    /* Estilos responsivos */
    @media (max-width: 768px) {
        h1 {
            font-size: 1.5rem;
        }
        .card {
            padding: 10px;
        }
        table {
            font-size: 0.8rem;
        }
    }
</style>
</head>

<body>

<h1><i class="fas fa-piggy-bank icon"></i> ðŸ“Š Presupuesto Personal Mensual</h1>

<div class="card">
    <h3>ðŸ’µ Ingreso mensual</h3>
    <input type="number" id="ingreso" placeholder="Ej: 3500000">
    <button class="btn-add" onclick="guardarIngreso()">Guardar ingreso</button>
</div>

<div class="card">
    <h3>ðŸ“Œ Agregar deuda</h3>
    <input type="text" id="nombre" placeholder="Nombre de la deuda">
    <input type="number" id="valorPrestamo" placeholder="Valor del prÃ©stamo">
    <input type="number" id="interes" placeholder="Porcentaje de interÃ©s mensual (0 si no aplica)">
    <input type="number" id="tiempoMeses" placeholder="Tiempo en meses">
    <button class="btn-add" onclick="agregarDeuda()">Agregar deuda</button>
</div>

<div class="card">
    <h3>ðŸ“‹ Detalle de deudas</h3>
    <table>
        <thead>
            <tr>
                <th>Deuda</th>
                <th>Valor del prÃ©stamo</th>
                <th>InterÃ©s</th>
                <th>Tiempo (meses)</th>
                <th>Cuota mensual</th>
                <th>Total a pagar</th>
                <th>AcciÃ³n</th>
            </tr>
        </thead>
        <tbody id="tabla"></tbody>
    </table>

    <p class="resumen">Total de deudas: $<span id="totalDeudas">0</span></p>
    <p class="resumen">Saldo disponible: 
        $<span id="saldo" class="positivo">0</span>
    </p>

    <p class="resumen">Selecciona una deuda para simulaciÃ³n de pago anticipado: </p>
    <!-- Este es el select donde se elegirÃ¡n las deudas -->
    <select id="selectDeuda">
        <option value="">-- Elige una deuda --</option>
    </select>
    <input type="number" id="nuevoTiempoMeses" placeholder="Nuevo tiempo en meses (Ej: 3)">
    <button class="btn-exp" onclick="simularPagoAnticipado()">Simular pago anticipado</button>
    <p id="simuladorResultado"></p>

    <button class="btn-exp" onclick="exportarExcel()">Exportar a Excel</button>
</div>

<script>
// Definimos las funciones aquÃ­ al final del archivo

let deudas = JSON.parse(localStorage.getItem("deudas")) || [];
let ingreso = Number(localStorage.getItem("ingreso")) || 0;

document.getElementById("ingreso").value = ingreso;
renderizar();

function guardarIngreso() {
    ingreso = Number(document.getElementById("ingreso").value);
    localStorage.setItem("ingreso", ingreso);
    renderizar();
}

function agregarDeuda() {
    const nombre = document.getElementById("nombre").value;
    const valorPrestamo = Number(document.getElementById("valorPrestamo").value);
    const interes = Number(document.getElementById("interes").value);
    const tiempoMeses = Number(document.getElementById("tiempoMeses").value);

    // ValidaciÃ³n de los campos
    if (nombre === "" || valorPrestamo <= 0 || tiempoMeses <= 0) {
        alert("Datos invÃ¡lidos");
        return;
    }

    // Si no hay interÃ©s (0%), lo tratamos como deuda sin interÃ©s
    let cuotaMensual = 0;
    let totalPagar = 0;

    if (interes === 0) {
        cuotaMensual = valorPrestamo / tiempoMeses;  // Deuda sin interÃ©s
        totalPagar = valorPrestamo;  // Total a pagar es igual al valor del prÃ©stamo
    } else {
        cuotaMensual = calcularCuotaMensual(valorPrestamo, interes, tiempoMeses);
        totalPagar = cuotaMensual * tiempoMeses;
    }

    // Crear un objeto deuda y agregarlo al arreglo de deudas
    const nuevaDeuda = { nombre, valorPrestamo, interes, tiempoMeses, cuotaMensual, totalPagar };
    
    // Asegurarse de que la deuda se haya creado correctamente
    console.log('Deuda agregada:', nuevaDeuda);

    // Agregar deuda al arreglo de deudas
    deudas.push(nuevaDeuda);

    // Guardar el arreglo actualizado de deudas en localStorage
    localStorage.setItem("deudas", JSON.stringify(deudas));

    // Limpiar los campos de entrada
    document.getElementById("nombre").value = "";
    document.getElementById("valorPrestamo").value = "";
    document.getElementById("interes").value = "";
    document.getElementById("tiempoMeses").value = "";

    // Llamar a renderizar() para actualizar la tabla con la nueva deuda
    renderizar();
}

function eliminarDeuda(index) {
    deudas.splice(index, 1);
    localStorage.setItem("deudas", JSON.stringify(deudas));
    renderizar();
}

function renderizar() {
    const tabla = document.getElementById("tabla");
    tabla.innerHTML = "";  // Limpiar la tabla antes de volver a renderizarla
    let total = 0;

    // Verificar que la variable de deudas no estÃ© vacÃ­a
    console.log('Deudas actuales:', deudas);

    // Recorrer todas las deudas y mostrar sus detalles
    deudas.forEach((d, i) => {
        total += d.totalPagar;  // Sumar el total de cada deuda

        const fila = tabla.insertRow();
        fila.insertCell(0).innerText = d.nombre;
        fila.insertCell(1).innerText = `$${d.valorPrestamo.toLocaleString()}`;
        fila.insertCell(2).innerText = `${d.interes}%`;
        fila.insertCell(3).innerText = d.tiempoMeses;
        fila.insertCell(4).innerText = `$${(d.cuotaMensual || 0).toLocaleString()}`;
        fila.insertCell(5).innerText = `$${(d.totalPagar || 0).toLocaleString()}`;

        // AÃ±adir las deudas al select para simular el pago anticipado
        const select = document.getElementById("selectDeuda");
        const option = document.createElement("option");
        option.value = i;
        option.textContent = d.nombre;
        select.appendChild(option);

        fila.insertCell(6).innerHTML =
            `<button class="btn-del" onclick="eliminarDeuda(${i})">Eliminar</button>`;
    });

    document.getElementById("totalDeudas").innerText = total.toLocaleString();
    const saldo = ingreso - deudas.reduce((acc, d) => acc + (d.cuotaMensual || 0), 0); // Restar solo las cuotas mensuales
    const saldoSpan = document.getElementById("saldo");
    saldoSpan.innerText = saldo.toLocaleString();
    saldoSpan.className = saldo < 0 ? "negativo" : "positivo";
}

// CÃ¡lculo de la cuota mensual
function calcularCuotaMensual(valorPrestamo, interes, tiempoMeses) {
    const totalConInteres = valorPrestamo * (1 + (interes / 100) * tiempoMeses); 
    return totalConInteres / tiempoMeses;  // Dividir entre el tiempo en meses para obtener la cuota mensual
}

function simularPagoAnticipado() {
    const select = document.getElementById("selectDeuda");
    const deudaIndex = select.value;

    if (deudaIndex === "") {
        alert("Por favor selecciona una deuda para simular.");
        return;
    }

    const deuda = deudas[deudaIndex];
    const nuevoTiempo = prompt("Ingresa el nuevo tiempo en meses (por ejemplo, 3 meses):", deuda.tiempoMeses);

    if (nuevoTiempo <= 0 || isNaN(nuevoTiempo)) {
        alert("Por favor ingresa un valor vÃ¡lido de tiempo.");
        return;
    }

    // Calcular la nueva cuota mensual con el tiempo reducido
    const nuevaCuotaMensual = calcularCuotaMensual(deuda.valorPrestamo, deuda.interes, nuevoTiempo);
    const nuevoTotalPagar = nuevaCuotaMensual * nuevoTiempo;

    const ahorro = deuda.totalPagar - nuevoTotalPagar;

    const resultado = `
        Deuda: ${deuda.nombre}<br>
        Nuevo tiempo: ${nuevoTiempo} meses<br>
        Nueva cuota mensual: $${nuevaCuotaMensual.toLocaleString()}<br>
        Nuevo total a pagar: $${nuevoTotalPagar.toLocaleString()}<br>
        Ahorro en intereses: $${ahorro.toLocaleString()}
    `;

    document.getElementById("simuladorResultado").innerHTML = resultado;
}

function exportarExcel() {
    let csv = "Deuda,Valor del prÃ©stamo,InterÃ©s,Tiempo (meses),Cuota mensual,Total a pagar\n";
    deudas.forEach(d => {
        csv += `${d.nombre},${d.valorPrestamo},${d.interes},${d.tiempoMeses},${d.cuotaMensual},${d.totalPagar}\n`;
    });

    csv += `\nIngreso mensual,${ingreso}\n`;
    csv += `Total de deudas,${deudas.reduce((s,d)=>s+d.totalPagar,0)}\n`;
    csv += `Saldo disponible,${ingreso - deudas.reduce((s,d)=>s+d.totalPagar,0)}`;

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "presupuesto_personal.csv";
    link.click();
}
</script>

</body>
</html>
