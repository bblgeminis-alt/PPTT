<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Presupuesto Personal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#0f172a;--card:#020617;--text:#e5e7eb;--muted:#94a3b8;
 --green:#22c55e;--blue:#3b82f6;--red:#ef4444;--border:#1e293b
}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);padding:16px}
h1,h3{text-align:center}
.card{background:var(--card);border-radius:14px;padding:16px;margin-bottom:16px;max-width:980px;margin:auto}
input,select,button{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#020617;color:var(--text);margin-bottom:10px}
button{font-weight:600}
.btn-add{background:var(--green);color:#022c22}
.btn-exp{background:var(--blue);color:#fff}
.sim-result{background:#0b1224;border-radius:10px;padding:12px;border:1px solid var(--border)}
.table-wrapper{overflow-x:auto}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #000;padding:8px;text-align:center}
</style>
</head>

<body>

<h1>üí∞ Presupuesto Personal</h1>

<!-- INGRESO -->
<div class="card">
 <h3>üíµ Ingreso mensual</h3>
 <input type="number" id="ingreso">
 <button class="btn-add" onclick="guardarIngreso()">Guardar ingreso</button>
 <canvas id="miniPie" style="max-width:260px;margin:auto"></canvas>
</div>

<!-- AGREGAR DEUDA -->
<div class="card">
 <h3>üìå Agregar deuda</h3>
 <input id="nombre" placeholder="Nombre">
 <input id="valorPrestamo" type="number" placeholder="Valor pr√©stamo">
 <input id="interes" type="number" placeholder="Inter√©s fijo por cuota">
 <input id="tiempoMeses" type="number" placeholder="Meses">
 <button class="btn-add" onclick="agregarDeuda()">Agregar</button>
</div>

<!-- SIMULADOR -->
<div class="card">
 <h3>‚è±Ô∏è Simulador pago anticipado</h3>
 <select id="selectSimulador"></select>

 <input type="number" id="cuotasPagadas" placeholder="N√∫mero de cuotas pagadas">
 <input type="number" id="nuevoTiempo" placeholder="Nuevo tiempo (meses)">

 <button class="btn-exp" onclick="simular()">Simular</button>

 <div id="resultadoSimulacion" class="sim-result" style="display:none"></div>
</div>

<!-- CRONOGRAMA -->
<div class="card">
 <h3>üìÜ Cronograma (inter√©s fijo por cuota)</h3>
 <select id="selectCronograma" onchange="generarCronograma()"></select>

 <div class="table-wrapper">
 <table>
  <thead>
   <tr>
    <th>Mes</th>
    <th>Cuota</th>
    <th>Inter√©s fijo</th>
    <th>Capital</th>
    <th>Saldo</th>
   </tr>
  </thead>
  <tbody id="tablaCuotas"></tbody>
 </table>
 </div>
</div>

<script>
let deudas = [];
let ingreso = 0;
let pie = null;

/* INGRESO */
function guardarIngreso(){
 ingreso = +document.getElementById("ingreso").value || 0;
 render();
}

/* AGREGAR DEUDA */
function agregarDeuda(){
 const n=nombre.value;
 const v=+valorPrestamo.value;
 const i=+interes.value;
 const m=+tiempoMeses.value;
 if(!n||v<=0||m<=0)return alert("Datos inv√°lidos");

 const totalInteres = i * m;
 const total = v + totalInteres;
 const cuota = total / m;

 deudas.push({
  nombre:n,
  valorPrestamo:v,
  interes:i,
  tiempoMeses:m,
  cuota:cuota,
  totalOriginal:total
 });

 render();
}

/* SIMULADOR */
function simular(){
 const idx=selectSimulador.value;
 const pagadas=+cuotasPagadas.value;
 const nuevo=+nuevoTiempo.value;
 if(idx===""||pagadas<0||nuevo<=0)return alert("Datos inv√°lidos");

 const d=deudas[idx];

 const totalCuotasPagadas = d.cuota * pagadas;
 const totalPagarCredito = d.valorPrestamo + (d.interes * nuevo);
 const nuevoSaldo = totalPagarCredito - totalCuotasPagadas;
 const ahorro = d.totalOriginal - totalPagarCredito;

 resultadoSimulacion.style.display="block";
 resultadoSimulacion.innerHTML=`
 <strong>${d.nombre}</strong><br>
 Tiempo original: ${d.tiempoMeses} meses<br>
 Tiempo nuevo: ${nuevo} meses<br><br>

 <strong>Total cuotas pagadas:</strong> $${totalCuotasPagadas.toLocaleString()}<br>
 <strong>Total a pagar cr√©dito:</strong> $${totalPagarCredito.toLocaleString()}<br>
 <strong>Nuevo saldo a pagar:</strong> $${nuevoSaldo.toLocaleString()}<br><br>

 <strong>Ahorro aproximado:</strong> $${ahorro.toLocaleString()}
 `;
}

/* CRONOGRAMA */
function generarCronograma(){
 tablaCuotas.innerHTML="";
 const idx=selectCronograma.value;
 if(idx==="")return;

 const d=deudas[idx];
 let saldo=d.valorPrestamo;

 for(let m=1;m<=d.tiempoMeses;m++){
  const capital=d.cuota-d.interes;
  saldo=Math.max(saldo-capital,0);

  tablaCuotas.innerHTML+=`
   <tr>
    <td>${m}</td>
    <td>${d.cuota.toFixed(0)}</td>
    <td>${d.interes.toFixed(0)}</td>
    <td>${capital.toFixed(0)}</td>
    <td>${saldo.toFixed(0)}</td>
   </tr>`;
 }
}

/* RENDER */
function render(){
 selectSimulador.innerHTML="";
 selectCronograma.innerHTML="";
 let cuotas=0;

 deudas.forEach((d,i)=>{
  cuotas+=d.cuota;
  selectSimulador.innerHTML+=`<option value="${i}">${d.nombre}</option>`;
  selectCronograma.innerHTML+=`<option value="${i}">${d.nombre}</option>`;
 });

 if(pie)pie.destroy();
 pie=new Chart(miniPie,{
  type:"doughnut",
  data:{labels:["Cuotas","Saldo"],
  datasets:[{data:[cuotas,Math.max(ingreso-cuotas,0)],
  backgroundColor:["#ef4444","#22c55e"]}]},
  options:{cutout:"60%"}
 });
}
</script>

</body>
</html>
