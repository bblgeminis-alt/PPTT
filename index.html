<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Presupuesto Personal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Librer√≠as -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
 --bg:#0f172a;--card:#020617;--text:#e5e7eb;--muted:#94a3b8;
 --green:#22c55e;--blue:#3b82f6;--red:#ef4444;--border:#1e293b
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);padding:16px}
h1,h3{text-align:center}
.card{
 background:var(--card);border-radius:14px;padding:16px;margin-bottom:16px;
 max-width:960px;margin-inline:auto;box-shadow:0 10px 30px rgba(0,0,0,.4)
}
input,select,button{
 width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);
 background:#020617;color:var(--text);font-size:16px;margin-bottom:10px
}
button{border:none;font-weight:600}
.btn-add{background:var(--green);color:#022c22}
.btn-exp{background:var(--blue);color:#fff}
.btn-del{background:var(--red);color:#fff}
.resumen{font-size:18px}
.positivo{color:var(--green)} .negativo{color:var(--red)}

.table-wrapper{overflow-x:auto}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--border);text-align:center}
th{color:var(--muted)}

@media(max-width:640px){
 table,thead,tbody,th,tr{display:block}
 thead{display:none}
 tr{
  background:#020617;border:1px solid var(--border);
  border-radius:12px;padding:12px;margin-bottom:12px
 }
 td{
  display:flex;justify-content:space-between;
  padding:6px 0;border:none
 }
 td::before{content:attr(data-label);color:var(--muted)}
}
</style>
</head>

<body>

<h1>üí∞ Presupuesto Personal</h1>

<!-- MES -->
<div class="card">
 <h3>üìÖ Mes de trabajo</h3>
 <input type="month" id="mesActual">
 <button class="btn-exp" onclick="guardarMes()">Guardar mes</button>
</div>

<!-- INGRESO -->
<div class="card">
 <h3>üíµ Ingreso mensual</h3>
 <input type="number" id="ingreso">
 <button class="btn-add" onclick="guardarIngreso()">Guardar ingreso</button>
</div>

<!-- AGREGAR DEUDA -->
<div class="card">
 <h3>üìå Agregar deuda</h3>
 <input id="nombre" placeholder="Nombre de la deuda">
 <input id="valorPrestamo" type="number" placeholder="Valor del pr√©stamo">
 <input id="interes" type="number" placeholder="Inter√©s mensual % (0 si no tiene)">
 <input id="tiempoMeses" type="number" placeholder="Meses">
 <button class="btn-add" onclick="agregarDeuda()">Agregar deuda</button>
</div>

<!-- TABLA DEUDAS -->
<div class="card">
 <h3>üìã Deudas</h3>
 <div class="table-wrapper">
 <table>
  <thead>
   <tr>
    <th>Deuda</th><th>Pr√©stamo</th><th>%</th><th>Meses</th>
    <th>Cuota</th><th>Total</th><th>Acci√≥n</th>
   </tr>
  </thead>
  <tbody id="tabla"></tbody>
 </table>
 </div>
 <p class="resumen">Total deudas: $<span id="totalDeudas">0</span></p>
 <p class="resumen">Saldo disponible: $<span id="saldo">0</span></p>
</div>

<!-- GRAFICOS -->
<div class="card">
 <h3>üìä Gr√°ficos</h3>
 <canvas id="graficoResumen"></canvas>
 <canvas id="graficoDeudas" style="margin-top:20px"></canvas>
</div>

<!-- SIMULADOR -->
<div class="card">
 <h3>‚è±Ô∏è Simular pago anticipado</h3>
 <select id="selectSimulador"></select>
 <input type="number" id="nuevoTiempo" placeholder="Nuevo tiempo en meses">
 <button class="btn-exp" onclick="simularPago()">Simular</button>
 <p id="resultadoSimulacion"></p>
</div>

<!-- CRONOGRAMA -->
<div class="card">
 <h3>üìÜ Cronograma de pagos</h3>

 <select id="selectCronograma" onchange="generarCronograma()">
  <option value="">-- Selecciona una deuda --</option>
 </select>

 <div class="table-wrapper" id="cronogramaExportable">
 <table>
  <thead>
   <tr>
    <th>Mes</th><th>Cuota</th><th>Inter√©s</th>
    <th>Capital</th><th>Saldo</th>
   </tr>
  </thead>
  <tbody id="tablaCuotas"></tbody>
 </table>
 </div>
</div>

<!-- EXPORTAR -->
<div class="card">
 <h3>üì§ Exportar cronograma</h3>
 <button class="btn-exp" onclick="exportarExcel()">Excel</button>
 <button class="btn-exp" onclick="exportarPDF()">PDF</button>
 <button class="btn-exp" onclick="exportarImagen()">Imagen</button>
 <button class="btn-exp" onclick="copiarPortapapeles()">Copiar</button>
</div>

<script>
let deudas = JSON.parse(localStorage.getItem("deudas")) || [];
let ingreso = Number(localStorage.getItem("ingreso")) || 0;
let g1=null, g2=null;

document.getElementById("ingreso").value = ingreso;
renderizar();

/* INGRESO */
function guardarIngreso(){
 ingreso = Number(document.getElementById("ingreso").value) || 0;
 localStorage.setItem("ingreso", ingreso);
 renderizar();
}

/* AGREGAR DEUDA */
function agregarDeuda(){
 const n=nombre.value, v=+valorPrestamo.value, i=+interes.value, m=+tiempoMeses.value;
 if(!n||v<=0||m<=0) return alert("Datos inv√°lidos");

 const total = i>0 ? v*(1+(i/100)*m) : v;
 const cuota = total/m;

 deudas.push({nombre:n,valorPrestamo:v,interes:i,tiempoMeses:m,cuotaMensual:cuota,totalPagar:total});
 localStorage.setItem("deudas",JSON.stringify(deudas));
 renderizar();
}

/* ELIMINAR */
function eliminarDeuda(i){
 deudas.splice(i,1);
 localStorage.setItem("deudas",JSON.stringify(deudas));
 renderizar();
}

/* RENDER */
function renderizar(){
 tabla.innerHTML="";
 selectSimulador.innerHTML="";
 selectCronograma.innerHTML='<option value="">-- Selecciona una deuda --</option>';

 let total=0, cuotas=0;

 deudas.forEach((d,i)=>{
  total+=d.totalPagar; cuotas+=d.cuotaMensual;

  tabla.innerHTML+=`
   <tr>
    <td data-label="Deuda">${d.nombre}</td>
    <td data-label="Pr√©stamo">$${d.valorPrestamo.toLocaleString()}</td>
    <td data-label="%">${d.interes}</td>
    <td data-label="Meses">${d.tiempoMeses}</td>
    <td data-label="Cuota">$${d.cuotaMensual.toLocaleString()}</td>
    <td data-label="Total">$${d.totalPagar.toLocaleString()}</td>
    <td data-label="Acci√≥n"><button class="btn-del" onclick="eliminarDeuda(${i})">X</button></td>
   </tr>`;

  let o1=document.createElement("option");o1.value=i;o1.text=d.nombre;selectSimulador.appendChild(o1);
  let o2=document.createElement("option");o2.value=i;o2.text=d.nombre;selectCronograma.appendChild(o2);
 });

 totalDeudas.innerText = total.toLocaleString();
 saldo.innerText = (ingreso-cuotas).toLocaleString();
 saldo.className = ingreso-cuotas<0?"negativo":"positivo";

 graficos();
}

/* GRAFICOS */
function graficos(){
 let cuotas = deudas.reduce((a,d)=>a+d.cuotaMensual,0);

 if(g1) g1.destroy();
 g1=new Chart(graficoResumen,{
  type:"doughnut",
  data:{labels:["Cuotas","Saldo"],
  datasets:[{data:[cuotas,Math.max(ingreso-cuotas,0)],
  backgroundColor:["#ef4444","#22c55e"]}]},
  options:{plugins:{legend:{labels:{color:"#e5e7eb"}}}}
 });

 if(g2) g2.destroy();
 g2=new Chart(graficoDeudas,{
  type:"bar",
  data:{labels:deudas.map(d=>d.nombre),
  datasets:[{label:"Cuota mensual",data:deudas.map(d=>d.cuotaMensual),
  backgroundColor:"#3b82f6"}]},
  options:{scales:{x:{ticks:{color:"#e5e7eb"}},y:{ticks:{color:"#e5e7eb"}}},
  plugins:{legend:{labels:{color:"#e5e7eb"}}}}
 });
}

/* SIMULADOR */
function simularPago(){
 const i=selectSimulador.value, n=+nuevoTiempo.value;
 if(i===""||n<=0) return alert("Datos inv√°lidos");
 const d=deudas[i];
 const nuevoTotal = d.interes>0 ? d.valorPrestamo*(1+(d.interes/100)*n) : d.valorPrestamo;
 resultadoSimulacion.innerHTML=
  `Nuevo total: $${nuevoTotal.toLocaleString()}<br>
   Ahorro: $${(d.totalPagar-nuevoTotal).toLocaleString()}`;
}

/* CRONOGRAMA */
function generarCronograma(){
 const i=selectCronograma.value;
 tablaCuotas.innerHTML="";
 if(i==="") return;

 const d=deudas[i];
 let saldo=d.valorPrestamo;

 for(let mes=1;mes<=d.tiempoMeses;mes++){
  const interes=saldo*(d.interes/100);
  const capital=d.cuotaMensual-interes;
  saldo=Math.max(saldo-capital,0);

  tablaCuotas.innerHTML+=`
   <tr>
    <td data-label="Mes">${mes}</td>
    <td data-label="Cuota">$${d.cuotaMensual.toLocaleString()}</td>
    <td data-label="Inter√©s">$${interes.toLocaleString()}</td>
    <td data-label="Capital">$${capital.toLocaleString()}</td>
    <td data-label="Saldo">$${saldo.toLocaleString()}</td>
   </tr>`;
 }
}

/* EXPORTACIONES */
function exportarExcel(){
 const i=selectCronograma.value;
 if(i==="") return alert("Selecciona una deuda");
 const d=deudas[i];
 let saldo=d.valorPrestamo;
 let csv="Mes,Cuota,Inter√©s,Capital,Saldo\n";

 for(let m=1;m<=d.tiempoMeses;m++){
  const interes=saldo*(d.interes/100);
  const capital=d.cuotaMensual-interes;
  saldo=Math.max(saldo-capital,0);
  csv+=`${m},${d.cuotaMensual},${interes},${capital},${saldo}\n`;
 }

 const blob=new Blob([csv],{type:"text/csv"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="cronograma_deuda.csv";
 a.click();
}

function exportarPDF(){
 if(selectCronograma.value==="") return alert("Selecciona una deuda");
 html2pdf().from(cronogramaExportable).save("cronograma_deuda.pdf");
}

function exportarImagen(){
 if(selectCronograma.value==="") return alert("Selecciona una deuda");
 html2canvas(cronogramaExportable).then(c=>{
  const a=document.createElement("a");
  a.href=c.toDataURL();a.download="cronograma_deuda.png";a.click();
 });
}

function copiarPortapapeles(){
 const i=selectCronograma.value;
 if(i==="") return alert("Selecciona una deuda");
 const d=deudas[i];
 let saldo=d.valorPrestamo;
 let texto=`Cronograma - ${d.nombre}\n`;

 for(let m=1;m<=d.tiempoMeses;m++){
  const interes=saldo*(d.interes/100);
  const capital=d.cuotaMensual-interes;
  saldo=Math.max(saldo-capital,0);
  texto+=`Mes ${m}: saldo $${saldo}\n`;
 }

 navigator.clipboard.writeText(texto)
  .then(()=>alert("Cronograma copiado"));
}

/* HISTORICO */
function guardarMes(){
 const m=mesActual.value;
 if(!m) return alert("Selecciona un mes");
 const h=JSON.parse(localStorage.getItem("historico"))||{};
 h[m]={ingreso,deudas};
 localStorage.setItem("historico",JSON.stringify(h));
 alert("Mes guardado");
}
</script>

</body>
</html>
