<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Presupuesto Personal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- LibrerÃ­as -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* ===== TEMA OSCURO ===== */
:root{
 --bg:#0f172a;--card:#020617;--text:#e5e7eb;--muted:#94a3b8;
 --green:#22c55e;--blue:#3b82f6;--red:#ef4444;--border:#1e293b
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);padding:16px}
h1,h3{text-align:center}

.card{
 background:var(--card);
 border-radius:14px;
 padding:16px;
 margin-bottom:16px;
 max-width:980px;
 margin-inline:auto;
 box-shadow:0 10px 30px rgba(0,0,0,.4)
}

input,select,button{
 width:100%;
 padding:12px;
 border-radius:10px;
 border:1px solid var(--border);
 background:#020617;
 color:var(--text);
 font-size:16px;
 margin-bottom:10px
}
button{border:none;font-weight:600}
.btn-add{background:var(--green);color:#022c22}
.btn-exp{background:var(--blue);color:#fff}
.btn-del{background:var(--red);color:#fff}
.resumen{font-size:18px}
.positivo{color:var(--green)}
.negativo{color:var(--red)}

.table-wrapper{overflow-x:auto}

/* ===== TABLA NORMAL ===== */
table{
 width:100%;
 border-collapse:collapse;
}
th,td{
 padding:10px;
 border:1px solid var(--border);
 text-align:center;
}
th{
 color:var(--muted);
 background:#020617;
}

/* ===== MODO MÃ“VIL â†’ TARJETAS CON ETIQUETAS ===== */
@media(max-width:640px){
 table,thead,tbody,th,tr{display:block}
 thead{display:none}
 tr{
  background:#020617;
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  margin-bottom:12px
 }
 td{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  border:none
 }
 td::before{
  content:attr(data-label);
  color:var(--muted);
  font-weight:500
 }
}

/* ===== ESTILO EXCEL PARA EXPORTACIÃ“N ===== */
.excel-export{
 background:white;
 color:black;
 padding:12px;
}
.excel-export table{
 border-collapse:collapse;
 width:100%;
 font-size:12px;
}
.excel-export th,
.excel-export td{
 border:1px solid #000;
 padding:6px;
 text-align:right;
}
.excel-export th{
 background:#e5e7eb;
 text-align:center;
 font-weight:bold;
}
</style>
</head>

<body>

<h1>ðŸ’° Presupuesto Personal</h1>

<!-- INGRESO -->
<div class="card">
 <h3>ðŸ’µ Ingreso mensual</h3>
 <input type="number" id="ingreso">
 <button class="btn-add" onclick="guardarIngreso()">Guardar ingreso</button>
</div>

<!-- AGREGAR DEUDA -->
<div class="card">
 <h3>ðŸ“Œ Agregar deuda</h3>
 <input id="nombre" placeholder="Nombre de la deuda">
 <input id="valorPrestamo" type="number" placeholder="Valor del prÃ©stamo">
 <input id="interes" type="number" placeholder="InterÃ©s mensual % (0 si no tiene)">
 <input id="tiempoMeses" type="number" placeholder="Meses">
 <button class="btn-add" onclick="agregarDeuda()">Agregar deuda</button>
</div>

<!-- TABLA DEUDAS -->
<div class="card">
 <h3>ðŸ“‹ Detalle de deudas</h3>
 <div class="table-wrapper">
 <table>
  <thead>
   <tr>
    <th>Deuda</th>
    <th>PrÃ©stamo</th>
    <th>InterÃ©s %</th>
    <th>Meses</th>
    <th>Cuota</th>
    <th>Total</th>
    <th>AcciÃ³n</th>
   </tr>
  </thead>
  <tbody id="tabla"></tbody>
 </table>
 </div>
</div>

<!-- CRONOGRAMA -->
<div class="card">
 <h3>ðŸ“† Cronograma (formato Excel)</h3>

 <select id="selectCronograma" onchange="generarCronograma()">
  <option value="">-- Selecciona una deuda --</option>
 </select>

 <div class="table-wrapper excel-export" id="cronogramaExportable">
 <table>
  <thead>
   <tr>
    <th>Mes</th>
    <th>Cuota</th>
    <th>InterÃ©s</th>
    <th>Capital</th>
    <th>Saldo</th>
   </tr>
  </thead>
  <tbody id="tablaCuotas"></tbody>
 </table>
 </div>
</div>

<!-- EXPORTAR -->
<div class="card">
 <h3>ðŸ“¤ Exportar cronograma</h3>
 <button class="btn-exp" onclick="exportarExcel()">Excel</button>
 <button class="btn-exp" onclick="exportarPDF()">PDF</button>
 <button class="btn-exp" onclick="exportarImagen()">Imagen</button>
</div>

<script>
let deudas = JSON.parse(localStorage.getItem("deudas")) || [];
let ingreso = Number(localStorage.getItem("ingreso")) || 0;
document.getElementById("ingreso").value = ingreso;
renderizar();

/* INGRESO */
function guardarIngreso(){
 ingreso = Number(ingreso=document.getElementById("ingreso").value)||0;
 localStorage.setItem("ingreso",ingreso);
}

/* AGREGAR */
function agregarDeuda(){
 const n=nombre.value,v=+valorPrestamo.value,i=+interes.value,m=+tiempoMeses.value;
 if(!n||v<=0||m<=0) return alert("Datos invÃ¡lidos");
 const total=i>0?v*(1+(i/100)*m):v;
 const cuota=total/m;
 deudas.push({nombre:n,valorPrestamo:v,interes:i,tiempoMeses:m,cuotaMensual:cuota,totalPagar:total});
 localStorage.setItem("deudas",JSON.stringify(deudas));
 renderizar();
}

/* RENDER */
function renderizar(){
 tabla.innerHTML="";
 selectCronograma.innerHTML='<option value="">-- Selecciona una deuda --</option>';

 deudas.forEach((d,i)=>{
  tabla.innerHTML+=`
   <tr>
    <td data-label="Deuda">${d.nombre}</td>
    <td data-label="PrÃ©stamo">$${d.valorPrestamo.toLocaleString()}</td>
    <td data-label="InterÃ©s %">${d.interes}</td>
    <td data-label="Meses">${d.tiempoMeses}</td>
    <td data-label="Cuota">$${d.cuotaMensual.toLocaleString()}</td>
    <td data-label="Total">$${d.totalPagar.toLocaleString()}</td>
    <td data-label="AcciÃ³n">
      <button class="btn-del" onclick="eliminarDeuda(${i})">Eliminar</button>
    </td>
   </tr>`;
  let o=document.createElement("option");
  o.value=i;o.text=d.nombre;
  selectCronograma.appendChild(o);
 });
}

/* ELIMINAR */
function eliminarDeuda(i){
 deudas.splice(i,1);
 localStorage.setItem("deudas",JSON.stringify(deudas));
 renderizar();
}

/* CRONOGRAMA */
function generarCronograma(){
 tablaCuotas.innerHTML="";
 const i=selectCronograma.value;
 if(i==="") return;
 const d=deudas[i];
 let saldo=d.valorPrestamo;

 for(let m=1;m<=d.tiempoMeses;m++){
  const interes=saldo*(d.interes/100);
  const capital=d.cuotaMensual-interes;
  saldo=Math.max(saldo-capital,0);
  tablaCuotas.innerHTML+=`
   <tr>
    <td>${m}</td>
    <td>${d.cuotaMensual.toFixed(0)}</td>
    <td>${interes.toFixed(0)}</td>
    <td>${capital.toFixed(0)}</td>
    <td>${saldo.toFixed(0)}</td>
   </tr>`;
 }
}

/* EXPORTAR */
function exportarExcel(){
 const i=selectCronograma.value;
 if(i==="") return alert("Selecciona una deuda");
 let csv="Mes,Cuota,InterÃ©s,Capital,Saldo\n";
 const d=deudas[i];
 let saldo=d.valorPrestamo;

 for(let m=1;m<=d.tiempoMeses;m++){
  const interes=saldo*(d.interes/100);
  const capital=d.cuotaMensual-interes;
  saldo=Math.max(saldo-capital,0);
  csv+=`${m},${d.cuotaMensual},${interes},${capital},${saldo}\n`;
 }
 const blob=new Blob([csv],{type:"text/csv"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="cronograma.xlsx.csv";
 a.click();
}

function exportarPDF(){
 if(selectCronograma.value==="") return alert("Selecciona una deuda");
 html2pdf().from(cronogramaExportable).save("cronograma_deuda.pdf");
}

function exportarImagen(){
 if(selectCronograma.value==="") return alert("Selecciona una deuda");
 html2canvas(cronogramaExportable).then(c=>{
  const a=document.createElement("a");
  a.href=c.toDataURL();
  a.download="cronograma_deuda.png";
  a.click();
 });
}
</script>

</body>
</html>
